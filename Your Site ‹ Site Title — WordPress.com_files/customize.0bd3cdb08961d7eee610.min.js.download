webpackJsonp(["customize"],{"./client/components/sidebar-navigation/index.jsx":function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var r=n("./node_modules/babel-runtime/core-js/object/get-prototype-of.js"),s=i(r),o=n("./node_modules/babel-runtime/helpers/classCallCheck.js"),a=i(o),u=n("./node_modules/babel-runtime/helpers/createClass.js"),l=i(u),c=n("./node_modules/babel-runtime/helpers/possibleConstructorReturn.js"),d=i(c),m=n("./node_modules/babel-runtime/helpers/inherits.js"),f=i(m),p=n("./node_modules/prop-types/index.js"),h=i(p),g=n("./node_modules/react/react.js"),_=i(g),T=n("./node_modules/react-redux/es/index.js"),v=n("./node_modules/gridicons/build/index.js"),E=i(v),y=n("./client/state/document-head/selectors.js"),j=n("./client/state/ui/layout-focus/actions.js"),b=function(e){function t(e){(0,a.default)(this,t);var n=(0,d.default)(this,(t.__proto__||(0,s.default)(t)).call(this,e));return n.toggleSidebar=n.toggleSidebar.bind(n),n}return(0,f.default)(t,e),(0,l.default)(t,[{key:"toggleSidebar",value:function(e){e.preventDefault(),this.props.setLayoutFocus("sidebar")}},{key:"render",value:function(){return _.default.createElement("header",{className:"current-section"},_.default.createElement("a",{onClick:this.toggleSidebar,className:this.props.linkClassName},_.default.createElement(E.default,{icon:"chevron-left"}),this.props.children,_.default.createElement("div",null,_.default.createElement("p",{className:"current-section__"+this.props.sectionName+"-title"},this.props.sectionTitle),_.default.createElement("h1",{className:"current-section__section-title"},this.props.title))))}}]),t}(_.default.Component);b.propTypes={title:h.default.string,linkClassName:h.default.string,sectionTitle:h.default.string,sectionName:h.default.string.isRequired,setLayoutFocus:h.default.func.isRequired},t.default=(0,T.connect)(function(e){return{title:(0,y.getDocumentHeadTitle)(e)}},{setLayoutFocus:j.setLayoutFocus})(b),e.exports=t.default},"./client/lib/upgrades/actions/cart.js":function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function r(){E.default.handleViewAction({type:T.action.CART_DISABLE})}function s(e){E.default.handleViewAction({type:T.action.CART_POPUP_OPEN,options:e||{}})}function o(){E.default.handleViewAction({type:T.action.CART_POPUP_CLOSE})}function a(e){E.default.handleViewAction({type:T.action.CART_ON_MOBILE_SHOW,show:e})}function u(){E.default.handleViewAction({type:T.action.CART_PRIVACY_PROTECTION_ADD})}function l(){E.default.handleViewAction({type:T.action.CART_PRIVACY_PROTECTION_REMOVE})}function c(e){d([e])}function d(e){var t=e.map(function(e){var t=(0,_.assign)({},e.extra,{context:"calypstore"});return(0,_.assign)({},e,{extra:t})});E.default.handleViewAction({type:T.action.CART_ITEMS_ADD,cartItems:t})}function m(e,t){E.default.handleViewAction({type:T.action.CART_ITEM_REMOVE,cartItem:e,domainsWithPlansOnly:t})}function f(e){c(y.cartItems.domainRegistration({domain:e.domain_name,productSlug:e.product_slug}))}function p(e){E.default.handleViewAction({type:T.action.GOOGLE_APPS_REGISTRATION_DATA_ADD,registrationData:e})}function h(e){m(y.cartItems.domainRegistration({domain:e.domain_name,productSlug:e.product_slug}))}function g(e){E.default.handleViewAction({type:T.action.CART_COUPON_APPLY,coupon:e})}Object.defineProperty(t,"__esModule",{value:!0}),t.showCartOnMobile=t.removePrivacyFromAllDomains=t.removeItem=t.removeDomainFromCart=t.openCartPopup=t.disableCart=t.closeCartPopup=t.applyCoupon=t.addPrivacyToAllDomains=t.addItems=t.addItem=t.addGoogleAppsRegistrationData=t.addDomainToCart=void 0;var _=n("./node_modules/lodash/lodash.js"),T=n("./client/lib/upgrades/constants.js"),v=n("./client/dispatcher/index.js"),E=i(v),y=n("./client/lib/cart-values/index.js");n("./client/lib/cart/store/index.js"),t.addDomainToCart=f,t.addGoogleAppsRegistrationData=p,t.addItem=c,t.addItems=d,t.addPrivacyToAllDomains=u,t.applyCoupon=g,t.closeCartPopup=o,t.disableCart=r,t.openCartPopup=s,t.removeDomainFromCart=h,t.removeItem=m,t.removePrivacyFromAllDomains=l,t.showCartOnMobile=a},"./client/lib/wporg/index.js":function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function r(){var e,t;return e=u.default.getLocaleSlug(),t=(0,d.find)((0,h.default)("languages"),{langSlug:e}).wpLocale,""===t&&(t=e),t}Object.defineProperty(t,"__esModule",{value:!0});var s=n("./node_modules/debug/browser.js"),o=i(s),a=n("./node_modules/i18n-calypso/index.js"),u=i(a),l=n("./node_modules/superagent/lib/client.js"),c=i(l),d=n("./node_modules/lodash/lodash.js"),m=n("./client/lib/wporg/jsonp.js"),f=i(m),p=n("./client/config/index.js"),h=i(p),g=(0,o.default)("wporg"),_="https://api.wordpress.org/plugins/info/1.1/?action=query_plugins",T=24,v="all",E=1,y="https://api.wordpress.org/themes/info/1.1/";t.default={fetchPluginInformation:function(e,t){var n,i={fields:"icons,banners,compatibility,ratings,-contributors",locale:r()};e=e.replace(new RegExp(".php$"),""),n="https://api.wordpress.org/plugins/info/1.0/"+e+".jsonp",(0,f.default)(n,i,function(e,n){return e?(g("error downloading plugin details from .org: %s",e),void t(e,null)):n&&n.slug?void t(null,n):(g("unrecognized format fetching plugin details from .org: %s",n),void t(new Error("Unrecognized response format"),null))})},fetchPluginsList:function(e,t){var n;e.page=e.page||E,e.pageSize=e.pageSize||T,e.category=e.category||v,e.search=e.search,n="request[page]="+e.page+"&request[per_page]="+e.pageSize+"&request[fields][icons]=1&request[fields][banners]=1&request[fields][compatibility]=1&request[fields][tested]=0&request[fields][requires]=0&request[fields][sections]=0",n+=e.search?"&request[search]="+e.search:"&request[browse]="+e.category,c.default.post(_).set("Accept","application/json").send(encodeURI(n)).end(function(e,n){t(e,n.body)})},fetchThemeInformation:function(e){var t={action:"theme_information","request[fields][extended_author]":!0,"request[slug]":e};return c.default.get(y).set("Accept","application/json").query(t).then(function(e){var t=e.body;return t})},fetchThemesList:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.search,n=e.page,i=e.number,r={action:"query_themes","request[fields][extended_author]":!0,"request[search]":t,"request[page]":n,"request[per_page]:":i};return c.default.get(y).set("Accept","application/json").query(r).then(function(e){var t=e.body;return t})}},e.exports=t.default},"./client/lib/wporg/jsonp.js":function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function r(){}function s(e,t,n){function i(){o.parentNode&&o.parentNode.removeChild(o),window[u]=r,a&&clearTimeout(a)}function s(){window[u]&&i()}var o,a,u,m="__jp",f=6e4,p=encodeURIComponent,h=document.getElementsByTagName("script")[0]||document.head;return u=m+d++,f&&(a=setTimeout(function(){i(),n&&n(new Error("Timeout"))},f)),window[u]=function(e){c("jsonp got",e),i(),n&&n(null,e)},e+="="+p(u)+"?"+l.default.stringify(t),c('jsonp req "%s"',e),o=document.createElement("script"),o.src=e,h.parentNode.insertBefore(o,h),s}Object.defineProperty(t,"__esModule",{value:!0});var o=n("./node_modules/debug/browser.js"),a=i(o),u=n("./node_modules/qs/lib/index.js"),l=i(u),c=(0,a.default)("jsonp");t.default=s;var d=0;e.exports=t.default},"./client/my-sites/customize/actions.js":function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var r=n("./node_modules/lodash/lodash.js"),s=n("./client/dispatcher/index.js"),o=i(s),a=n("./node_modules/page/index.js"),u=i(a),l=n("./client/lib/upgrades/actions/cart.js"),c=n("./client/my-sites/themes/helpers.js"),d=n("./client/lib/cart-values/cart-items.js"),m={purchase:function(e,t){(0,l.addItem)((0,d.themeItem)(e,"customizer")),(0,c.trackClick)("customizer","purchase"),(0,r.defer)(function(){(0,u.default)("/checkout/"+t.slug),o.default.handleViewAction({type:"THEME_PURCHASE_WITH_CUSTOMIZER",id:e,site:t})})},activated:function(e,t,n){(0,c.trackClick)("customizer","activate"),(0,u.default)("/themes/"+t.slug),n(e,t.ID,"customizer")},close:function(e){e.indexOf("/themes")>-1&&(0,c.trackClick)("customizer","close"),o.default.handleViewAction({type:"CLOSED_CUSTOMIZER",previousPath:e})}};t.default=m,e.exports=t.default},"./client/my-sites/customize/controller.js":function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function r(e){var t=n("./client/my-sites/customize/main.jsx"),i=(0,m.sectionify)(e.path);p.default.pageView.record(i,"Customizer"),e.store.dispatch((0,h.setDocumentHeadTitle)(o.default.translate("Customizer",{textOnly:!0}))),u.default.render(c.default.createElement(d.Provider,{store:e.store},c.default.createElement(t,{domain:e.params.domain||"",pathname:e.pathname,prevPath:e.prevPath||"",query:e.query,panel:e.params.panel})),document.getElementById("primary"))}Object.defineProperty(t,"__esModule",{value:!0}),t.customize=r;var s=n("./node_modules/i18n-calypso/index.js"),o=i(s),a=n("./node_modules/react-dom/index.js"),u=i(a),l=n("./node_modules/react/react.js"),c=i(l),d=n("./node_modules/react-redux/es/index.js"),m=n("./client/lib/route/path.js"),f=n("./client/lib/analytics/index.js"),p=i(f),h=n("./client/state/document-head/actions.js")},"./client/my-sites/customize/index.js":function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){l.default.isEnabled("manage/customize")&&((0,s.default)("/customize/:panel([^.]+)?",o.siteSelection,o.sites),(0,s.default)("/customize/:panel?/:domain",o.siteSelection,o.navigation,a.customize))};var r=n("./node_modules/page/index.js"),s=i(r),o=n("./client/my-sites/controller.js"),a=n("./client/my-sites/customize/controller.js"),u=n("./client/config/index.js"),l=i(u);e.exports=t.default},"./client/my-sites/customize/loading-panel.jsx":function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var r=n("./node_modules/babel-runtime/core-js/object/get-prototype-of.js"),s=i(r),o=n("./node_modules/babel-runtime/helpers/classCallCheck.js"),a=i(o),u=n("./node_modules/babel-runtime/helpers/createClass.js"),l=i(u),c=n("./node_modules/babel-runtime/helpers/possibleConstructorReturn.js"),d=i(c),m=n("./node_modules/babel-runtime/helpers/inherits.js"),f=i(m),p=n("./node_modules/prop-types/index.js"),h=i(p),g=n("./node_modules/i18n-calypso/index.js"),_=n("./node_modules/react/react.js"),T=i(_),v=n("./node_modules/classnames/index.js"),E=i(v),y=n("./client/components/spinner/index.jsx"),j=i(y),b=function(e){function t(){return(0,a.default)(this,t),(0,d.default)(this,(t.__proto__||(0,s.default)(t)).apply(this,arguments))}return(0,f.default)(t,e),(0,l.default)(t,[{key:"render",value:function(){var e=(0,E.default)("customizer-loading-panel__notice",{"is-iframe-loaded":this.props.isLoaded});return T.default.createElement("div",{className:e},T.default.createElement("div",{className:"customizer-loading-panel__notice-label"},T.default.createElement(j.default,null),this.props.translate("Loading the Customizer…")))}}]),t}(T.default.Component);b.displayName="CustomizerLoadingPanel",b.propTypes={isLoaded:h.default.bool},b.defaultProps={isLoaded:!1},t.default=(0,g.localize)(b),e.exports=t.default},"./client/my-sites/customize/main.jsx":function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var r=n("./node_modules/babel-runtime/core-js/object/assign.js"),s=i(r),o=n("./node_modules/babel-runtime/core-js/object/get-prototype-of.js"),a=i(o),u=n("./node_modules/babel-runtime/helpers/classCallCheck.js"),l=i(u),c=n("./node_modules/babel-runtime/helpers/createClass.js"),d=i(c),m=n("./node_modules/babel-runtime/helpers/possibleConstructorReturn.js"),f=i(m),p=n("./node_modules/babel-runtime/helpers/inherits.js"),h=i(p),g=n("./node_modules/prop-types/index.js"),_=i(g),T=n("./node_modules/react/react.js"),v=i(T),E=n("./node_modules/i18n-calypso/index.js"),y=n("./node_modules/url/url.js"),j=i(y),b=n("./node_modules/qs/lib/index.js"),S=i(b),I=n("./node_modules/lodash/lodash.js"),w=n("./node_modules/react-redux/es/index.js"),A=n("./node_modules/debug/browser.js"),C=i(A),x=n("./client/notices/index.js"),R=i(x),P=n("./node_modules/page/index.js"),U=i(P),M=n("./client/my-sites/customize/loading-panel.jsx"),k=i(M),z=n("./client/components/empty-content/index.jsx"),q=i(z),L=n("./client/my-sites/sidebar-navigation/sidebar-navigation.jsx"),F=i(L),O=n("./client/my-sites/customize/actions.js"),N=i(O),D=n("./client/state/themes/actions.js"),H=n("./client/my-sites/customize/panels.js"),Q=n("./client/state/selectors/get-menus-url.js"),W=i(Q),V=n("./client/state/ui/selectors.js"),J=n("./client/state/sites/selectors.js"),B=(0,C.default)("calypso:my-sites:customize"),G=void 0,$=function(e){function t(e){(0,l.default)(this,t);var n=(0,f.default)(this,(t.__proto__||(0,a.default)(t)).call(this,e));return n.redirectIfNeeded=function(e){var t=n.props,i=t.menusUrl,r=t.isJetpack,s=t.customizerUrl;(0,I.startsWith)(e,"/customize/menus")&&e!==i&&(0,U.default)(i),r&&(0,U.default)(s)},n.canUserCustomizeDomain=function(){var e=n.props.site;return e?!(!e.capabilities||!e.capabilities.edit_theme_options)||(B("user cannot customize domain",n.props.domain),!1):(B("domain is not in the user's site list",n.props.domain),!1)},n.getPreviousPath=function(){var e=n.props.prevPath;return e&&!/^\/customize\/?/.test(e)||(e="/stats",n.props.domain&&(e+="/"+n.props.domain)),e},n.goBack=function(){var e=n.getPreviousPath();N.default.close(e),B("returning to previous page",e),U.default.back(e)},n.waitForLoading=function(){B("waiting for iframe to load"),n.cancelWaitingTimer(),G=setTimeout(n.cancelCustomizer,25e3)},n.cancelWaitingTimer=function(){G&&clearTimeout(G)},n.cancelCustomizer=function(){n.state.iframeLoaded||(B("iframe loading timed out"),n.setState({timeoutError:!0}))},n.getUrl=function(){var e=n.props.site;if(!e)return!1;var t="//"+e.domain;return e.options&&e.options.unmapped_url&&(t=e.options.unmapped_url),e.options&&e.options.admin_url?e.options.admin_url+"customize.php?"+n.buildCustomizerQuery():t+"/wp-admin/customize.php?"+n.buildCustomizerQuery()},n.buildCustomizerQuery=function(){var e=window.location,t=e.protocol,i=e.host,r=(0,I.cloneDeep)(n.props.query),o=n.props,a=o.panel,u=o.site;r.return=t+"//"+i+n.getPreviousPath(),r.calypso=!0,r.calypsoOrigin=t+"//"+i,u.options&&u.options.frame_nonce&&(r["frame-nonce"]=u.options.frame_nonce);var l=(0,H.getCustomizerFocus)(a);return l&&(0,s.default)(r,l),"amp"===a&&(r.customize_amp=1),S.default.stringify(r)},n.listenToCustomizer=function(){window.removeEventListener("message",n.onMessage,!1),window.addEventListener("message",n.onMessage,!1)},n.onMessage=function(e){var t=n.props.site;if(!t||!t.options)return void B("ignoring message received from iframe because the site data cannot be found");var i=j.default.parse(e.origin,!0),r=j.default.parse(t.options.unmapped_url);if(i.hostname!==n.props.domain&&i.hostname!==r.hostname)return void B("ignoring message received from iframe with incorrect origin",e.origin);if("string"!=typeof e.data||"{"!==e.data[0])return void B("ignoring message received from iframe with bad data",e.data);var s=JSON.parse(e.data);if(s.calypso&&s.command)switch(s.command){case"back":if(B("iframe says it is done",s),s.error)return void n.setState({errorFromIframe:s.error});s.warning&&R.default.warning(s.warning,{displayOnNextPage:!0}),s.info&&R.default.info(s.info,{displayOnNextPage:!0}),s.success&&R.default.success(s.success,{displayOnNextPage:!0}),n.goBack();break;case"loading":B("iframe says it is starting loading customizer"),n.cancelWaitingTimer();break;case"loaded":B("iframe says it is finished loading customizer"),n.cancelWaitingTimer(),n.setState({iframeLoaded:!0});break;case"activated":N.default.activated(s.theme.stylesheet,t,n.props.themeActivated);break;case"purchased":var o=s.theme.stylesheet.split("/")[1];N.default.purchase(o,t)}},n.renderErrorPage=function(e){return v.default.createElement("div",{className:"main main-column customize",role:"main"},v.default.createElement(F.default,null),v.default.createElement(q.default,{title:e.title,line:e.line,action:e.action,actionURL:e.actionURL,actionCallback:e.actionCallback}))},n.state={iframeLoaded:!1,errorFromIframe:!1,timeoutError:!1},n}return(0,h.default)(t,e),(0,d.default)(t,[{key:"componentWillMount",value:function(){this.redirectIfNeeded(this.props.pathname),this.listenToCustomizer(),this.waitForLoading()}},{key:"componentDidMount",value:function(){window&&window.scrollTo(0,0)}},{key:"componentWillUnmount",value:function(){window&&window.removeEventListener("message",this.onMessage,!1),this.cancelWaitingTimer()}},{key:"componentWillReceiveProps",value:function(e){this.redirectIfNeeded(e.pathname)}},{key:"render",value:function(){if(this.state.timeoutError)return this.cancelWaitingTimer(),this.renderErrorPage({title:this.props.translate("Sorry, the customizing tools did not load correctly"),action:this.props.translate("Try again"),actionCallback:function(){window.location.reload()}});if(this.state.errorFromIframe)return this.cancelWaitingTimer(),this.renderErrorPage({title:this.state.errorFromIframe});if(!this.props.site)return v.default.createElement("div",{className:"main main-column customize is-iframe",role:"main"},v.default.createElement(k.default,null));if(!this.canUserCustomizeDomain())return this.cancelWaitingTimer(),this.renderErrorPage({title:this.props.translate("Sorry, you do not have enough permissions to customize this site")});var e=this.getUrl();if(e){B("loading iframe URL",e);var t=this.state.iframeLoaded?"is-iframe-loaded":"";return v.default.createElement("div",{className:"main main-column customize is-iframe",role:"main"},v.default.createElement(k.default,{isLoaded:this.state.iframeLoaded}),v.default.createElement("iframe",{className:t,src:e}))}return this.cancelWaitingTimer(),this.renderErrorPage({title:this.props.translate("Sorry, the customizing tools did not load correctly"),action:this.props.translate("Try again"),actionCallback:function(){window.location.reload()}})}}]),t}(v.default.Component);$.propTypes={domain:_.default.string.isRequired,site:_.default.object.isRequired,pathname:_.default.string.isRequired,prevPath:_.default.string,query:_.default.object,themeActivated:_.default.func.isRequired,panel:_.default.string,isJetpack:_.default.bool,customizerUrl:_.default.string,translate:_.default.func.isRequired},$.defaultProps={domain:"",prevPath:null},t.default=(0,w.connect)(function(e){var t=(0,V.getSelectedSite)(e),n=(0,I.get)(t,"ID");return{site:t,menusUrl:(0,W.default)(e,n),isJetpack:(0,J.isJetpackSite)(e,n),customizerUrl:(0,J.getCustomizerUrl)(e,n)}},{themeActivated:D.themeActivated})((0,E.localize)($)),e.exports=t.default},"./client/my-sites/sidebar-navigation/sidebar-navigation.jsx":function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var r=n("./node_modules/react/react.js"),s=i(r),o=n("./node_modules/react-redux/es/index.js"),a=n("./node_modules/i18n-calypso/index.js"),u=n("./client/components/sidebar-navigation/index.jsx"),l=i(u),c=n("./client/blocks/site-icon/index.jsx"),d=i(c),m=n("./client/state/ui/selectors.js"),f=function(e){var t=e.site,n=e.translate,i=n("All Sites"),r="all-sites";return t&&(i=t.title,r=null),s.default.createElement(l.default,{linkClassName:r,sectionName:"site",sectionTitle:i},t&&s.default.createElement(d.default,{site:t}))};t.default=(0,o.connect)(function(e){return{site:(0,m.getSelectedSite)(e)}})((0,a.localize)(f)),e.exports=t.default},"./client/my-sites/themes/helpers.js":function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function r(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"click",i=e+" "+t+" "+n;d.default.ga.recordEvent("Themes",(0,f.default)(i))}function s(e){return(0,p.mapValues)(e,o)}function o(e,t){var n=e.action;return(0,l.default)({},e,{action:function(e){n&&n(e),r("more button",t)}})}function a(e,t,n){var i=(0,h.sectionify)(e),r="Themes";return t&&(i+="/type/:tier"),n&&(i+="/:site_id",r+=" > Single Site"),t&&(r+=" > Type > "+(0,f.default)(t)),{basePath:i,analyticsPageTitle:r}}Object.defineProperty(t,"__esModule",{value:!0});var u=n("./node_modules/babel-runtime/core-js/object/assign.js"),l=i(u);t.trackClick=r,t.addTracking=s,t.getAnalyticsData=a;var c=n("./client/lib/analytics/index.js"),d=i(c),m=n("./node_modules/to-title-case/index.js"),f=i(m),p=n("./node_modules/lodash/lodash.js"),h=n("./client/lib/route/path.js")},"./client/state/themes/actions.js":function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function r(e){return{type:G.THEME_BACK_PATH_SET,path:e}}function s(e,t){return o([e],t)}function o(e,t,n,i){return function(r,s){var o=e,a=i;if((0,K.isJetpackSite)(s(),t)){var u=(0,Y.shouldFilterWpcomThemes)(s(),t);o=(0,F.filter)(e,function(e){return(0,Z.isThemeMatchingQuery)(n,e)&&!(u&&(0,Z.isThemeFromWpcom)(e))}),a=o.length}r({type:G.THEMES_REQUEST_SUCCESS,themes:o,siteId:t,query:n,found:a})}}function a(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return function(n,i){var r=(new Date).getTime();n({type:G.THEMES_REQUEST,siteId:e,query:t});var s=void 0;return s="wporg"===e?function(){return B.default.fetchThemesList(t)}:"wpcom"===e?function(){return V.default.undocumented().themes(null,(0,L.default)({},t,{apiVersion:"1.2"}))}:function(){return V.default.undocumented().themes(e,(0,L.default)({},t,{apiVersion:"1"}))},s().then(function(s){var a=s.themes,u=s.info;u=void 0===u?{}:u;var l=u.results,c=s.found,d=void 0===c?l:c,m=void 0;if(m="wporg"===e?(0,F.map)(a,Z.normalizeWporgTheme):"wpcom"===e?(0,F.map)(a,Z.normalizeWpcomTheme):(0,F.map)(a,Z.normalizeJetpackTheme),(t.search||t.filter)&&1===t.page){var f=(new Date).getTime()-r,p=(0,ne.default)(i(),t.filter),h=p+(t.search||""),g=(0,$.recordTracksEvent)("calypso_themeshowcase_search",{search_term:h||null,search_taxonomies:p,tier:t.tier,response_time_in_ms:f,result_count:d,results_first_page:m.map((0,F.property)("id")).join()});n(g)}n(o(m,e,t,d))}).catch(function(i){n({type:G.THEMES_REQUEST_FAILURE,siteId:e,query:t,error:i})})}}function u(e,t,n){return{type:G.THEME_REQUEST_FAILURE,siteId:e,themeId:t,error:n}}function l(e,t){return function(n){return n({type:G.THEME_REQUEST,siteId:t,themeId:e}),"wporg"===t?B.default.fetchThemeInformation(e).then(function(i){if(!i)throw"Theme not found";n(s((0,Z.normalizeWporgTheme)(i),t)),n({type:G.THEME_REQUEST_SUCCESS,siteId:t,themeId:e})}).catch(function(i){n({type:G.THEME_REQUEST_FAILURE,siteId:t,themeId:e,error:i})}):"wpcom"===t?V.default.undocumented().themeDetails(e).then(function(i){n(s((0,Z.normalizeWpcomTheme)(i),t)),n({type:G.THEME_REQUEST_SUCCESS,siteId:t,themeId:e})}).catch(function(i){n({type:G.THEME_REQUEST_FAILURE,siteId:t,themeId:e,error:i})}):V.default.undocumented().jetpackThemeDetails(e,t).then(function(i){var r=i.themes;n(o((0,F.map)(r,Z.normalizeJetpackTheme),t)),n({type:G.THEME_REQUEST_SUCCESS,siteId:t,themeId:e})}).catch(function(i){n(u(t,e,i))})}}function c(e){return function(t,n){return t({type:G.ACTIVE_THEME_REQUEST,siteId:e}),V.default.undocumented().activeTheme(e).then(function(i){ae("Received current theme",i);var r=(0,K.isJetpackSite)(n(),e)?e:"wpcom";t(s(i,r)),t({type:G.ACTIVE_THEME_REQUEST_SUCCESS,siteId:e,theme:i})}).catch(function(n){t({type:G.ACTIVE_THEME_REQUEST_FAILURE,siteId:e,error:n})})}}function d(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"unknown",i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return function(r,s){if((0,K.isJetpackSite)(s(),t)&&!(0,Y.getTheme)(s(),t,e)){var o=M(s(),t,e);return r(v(o,t,n,i))}return r(m(e,t,n,i))}}function m(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"unknown",i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return function(r){return r({type:G.THEME_ACTIVATE,themeId:e,siteId:t}),V.default.undocumented().activateTheme(e,t).then(function(s){var o=s.stylesheet||e;r(f(o,t,n,i))}).catch(function(n){r({type:G.THEME_ACTIVATE_FAILURE,themeId:e,siteId:t,error:n})})}}function f(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"unknown",i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=function(r,s){var o={type:G.THEME_ACTIVATE_SUCCESS,themeStylesheet:e,siteId:t},a=(0,Y.getActiveTheme)(s(),t),u=(0,Y.getLastThemeQuery)(s(),t),l=(0,ne.default)(s(),u.filter),c=l+(u.search||""),d=(0,$.recordTracksEvent)("calypso_themeshowcase_theme_activate",{theme:(0,Z.getThemeIdFromStylesheet)(e),previous_theme:a,source:n,purchased:i,search_term:c||null,search_taxonomies:l});r((0,$.withAnalytics)(d,o))};return r}function p(e,t){return function(n,i){return n({type:G.THEME_INSTALL,siteId:t,themeId:e}),V.default.undocumented().installThemeOnJetpack(t,e).then(function(r){if(n(s(r,t)),n({type:G.THEME_INSTALL_SUCCESS,siteId:t,themeId:e}),(0,F.endsWith)(e,"-wpcom")){var o=(0,Y.getWpcomParentThemeId)(i(),e.replace("-wpcom",""));if(o)return n(p(o+"-wpcom",t))}}).catch(function(i){n({type:G.THEME_INSTALL_FAILURE,siteId:t,themeId:e,error:i})})}}function h(e){return{type:G.THEME_CLEAR_ACTIVATED,siteId:e}}function g(e,t){return function(n,i){if((0,K.isJetpackSite)(i(),t)&&!(0,Y.getTheme)(i(),t,e)){var r=M(i(),t,e);return n(_(r,t))}return n(T(e,t))}}function _(e,t){return function(n){return n(p(e,t)).then(function(){n(T(e,t))})}}function T(e,t){return function(n,i){var r=(0,Y.getThemeCustomizeUrl)(i(),e,t);return(0,Q.isExternal)(r)?void(window.location.href=r):void(0,H.default)((0,Y.getThemeCustomizeUrl)(i(),e,t))}}function v(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"unknown",i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return function(r){return r(p(e,t)).then(function(){r(m(e,t,n,i))})}}function E(e,t){return function(n){return n({type:G.THEME_UPLOAD_START,siteId:e}),V.default.undocumented().uploadTheme(e,t,function(t){n({type:G.THEME_UPLOAD_PROGRESS,siteId:e,loaded:t.loaded,total:t.total})}).then(function(t){n(s(t,e)),n({type:G.THEME_UPLOAD_SUCCESS,siteId:e,themeId:t.id})}).catch(function(t){n({type:G.THEME_UPLOAD_FAILURE,siteId:e,error:t})})}}function y(e){return{type:G.THEME_UPLOAD_CLEAR,siteId:e}}function j(e,t,n){var i=n?"plugins":"themes";return function(r){var s={type:G.THEME_TRANSFER_INITIATE_REQUEST,siteId:e};return r((0,$.withAnalytics)((0,$.recordTracksEvent)("calypso_automated_transfer_initiate_transfer",{plugin:n,context:i}),s)),V.default.undocumented().initiateTransfer(e,n,t,function(t){r({type:G.THEME_TRANSFER_INITIATE_PROGRESS,siteId:e,loaded:t.loaded,total:t.total})}).then(function(t){var s=t.transfer_id;if(!s)return r(I(e,{error:"initiate_failure"},n));var o={type:G.THEME_TRANSFER_INITIATE_SUCCESS,siteId:e,transferId:s};r((0,$.withAnalytics)((0,$.recordTracksEvent)("calypso_automated_transfer_initiate_success",{plugin:n,context:i}),o)),r(w(e,s))}).catch(function(t){r(I(e,t,n))})}}function b(e,t,n,i,r){return{type:G.THEME_TRANSFER_STATUS_RECEIVE,siteId:e,transferId:t,status:n,message:i,themeId:r}}function S(e,t,n){return{type:G.THEME_TRANSFER_STATUS_FAILURE,siteId:e,transferId:t,error:n}}function I(e,t,n){var i=n?"plugin":"theme";return function(r){var s={type:G.THEME_TRANSFER_INITIATE_FAILURE,siteId:e,error:t};r((0,$.withAnalytics)((0,$.recordTracksEvent)("calypso_automated_transfer_initiate_failure",{plugin:n,context:i}),s))}}function w(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3e3,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:18e4,r=Date.now()+i;return function(i){var s=function s(o,a){return Date.now()>r?(i(S(e,t,"client timeout")),o()):V.default.undocumented().transferStatus(e,t).then(function(r){var u=r.status,l=r.message,c=r.uploaded_theme_slug;if(i(b(e,t,u,l,c)),"complete"===u){var d=c?"themes":"plugins";return i((0,$.recordTracksEvent)("calypso_automated_transfer_complete",{transfer_id:t,context:d})),o()}return(0,F.delay)(s,n,o,a)}).catch(function(n){return i(S(e,t,n)),o()})};return new z.default(s)}}function A(e,t){return function(n){return n({type:G.THEME_DELETE,themeId:e,siteId:t}),V.default.undocumented().deleteThemeFromJetpack(t,e).then(function(i){n({type:G.THEME_DELETE_SUCCESS,themeId:e,siteId:t,themeName:i.name})}).catch(function(i){n({type:G.THEME_DELETE_FAILURE,themeId:e,siteId:t,error:i})})}}function C(e,t){return function(n,i){var r=(0,Y.getTheme)(i(),t,e),s=r.name,o=(0,K.getSiteTitle)(i(),t);(0,oe.default)(re.default.translate("Are you sure you want to delete %(themeName)s from %(siteTitle)s?",{args:{themeName:s,siteTitle:o},comment:"Themes: theme delete confirmation dialog"}),function(i){i&&n(A(e,t))},re.default.translate("Delete %(themeName)s",{args:{themeName:s},comment:"Themes: theme delete dialog confirm button"}),re.default.translate("Back",{context:"go back (like the back button in a browser)"}))}}function x(e,t){return{type:G.THEME_PREVIEW_OPTIONS,primary:e,secondary:t}}function R(e){return{type:G.THEME_PREVIEW_STATE,themeId:e}}function P(){return{type:G.THEME_PREVIEW_STATE,themeId:null}}function U(){return{type:G.THEME_FILTERS_REQUEST}}function M(e,t,n){return(0,ee.default)(e,t)?n:(0,Y.isDownloadableFromWpcom)(e,n)?n+"-wpcom":n}Object.defineProperty(t,"__esModule",{value:!0});var k=n("./node_modules/babel-runtime/core-js/promise.js"),z=i(k),q=n("./node_modules/babel-runtime/helpers/extends.js"),L=i(q);t.setBackPath=r,t.receiveTheme=s,t.receiveThemes=o,t.requestThemes=a,t.themeRequestFailure=u,t.requestTheme=l,t.requestActiveTheme=c,t.activate=d,t.activateTheme=m,t.themeActivated=f,t.installTheme=p,t.clearActivated=h,t.tryAndCustomize=g,t.installAndTryAndCustomizeTheme=_,t.tryAndCustomizeTheme=T,t.installAndActivateTheme=v,t.uploadTheme=E,t.clearThemeUpload=y,t.initiateThemeTransfer=j,t.pollThemeTransferStatus=w,t.deleteTheme=A,t.confirmDelete=C,t.setThemePreviewOptions=x,t.showThemePreview=R,t.hideThemePreview=P,t.requestThemeFilters=U;var F=n("./node_modules/lodash/lodash.js"),O=n("./node_modules/debug/browser.js"),N=i(O),D=n("./node_modules/page/index.js"),H=i(D),Q=n("./client/lib/url/index.js"),W=n("./client/lib/wp/browser.js"),V=i(W),J=n("./client/lib/wporg/index.js"),B=i(J),G=n("./client/state/action-types.js"),$=n("./client/state/analytics/actions.js"),Y=n("./client/state/themes/selectors.js"),Z=n("./client/state/themes/utils.js"),K=n("./client/state/sites/selectors.js"),X=n("./client/state/selectors/is-site-automated-transfer.js"),ee=i(X),te=n("./client/state/selectors/prepend-theme-filter-keys.js"),ne=i(te),ie=n("./node_modules/i18n-calypso/index.js"),re=i(ie),se=n("./client/lib/accept/index.js"),oe=i(se),ae=(0,N.default)("calypso:themes:actions")},"./client/state/themes/selectors.js":function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function r(e,t,n){var i=(0,O.find)(["wpcom","wporg",t],function(t){return K(e,t,n)});return K(e,i,n)}function s(e,t,n){return(0,O.get)(e.themes.themeRequestErrors,[n,t],null)}function o(e,t){return(0,O.get)(e.themes.lastQuery,t,{})}function a(e,t,n){var i=(0,$.getSerializedThemesQuery)(n,t);return!!e.themes.queryRequests[i]}function u(e,t,n){return e.themes.queries[t]?e.themes.queries[t].getFound(n):null}function l(e,t,n){if(!e.themes.queries[t])return null;var i=e.themes.queries[t].getNumberOfPages(n);return null===i?null:(0,J.isJetpackSite)(e,t)?1:Math.max(i,1)}function c(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=l(e,t,n);return null===i?i:i===(n.page||Y.DEFAULT_THEME_QUERY.page)}function d(e,t,n){return!!e.themes.themeRequests[t]&&!!e.themes.themeRequests[t][n]}function m(e,t){return(0,O.get)(e.themes.activeThemeRequests,t,!1)}function f(e,t){return!!K(e,"wpcom",t)}function p(e,t){return!!K(e,"wporg",t)}function h(e,t,n){if(!t)return null;if((0,J.isJetpackSite)(e,n)&&!(V.default.isEnabled("manage/themes/details/jetpack")&&(0,
J.canJetpackSiteManage)(e,n)&&(0,J.hasJetpackSiteJetpackThemesExtendedFeatures)(e,n)))return(0,J.getSiteOption)(e,n,"admin_url")+"themes.php?theme="+t;var i=$.oldShowcaseUrl+t;return V.default.isEnabled("manage/themes/details")&&(i="/theme/"+t),i+(n?"/"+(0,J.getSiteSlug)(e,n):"")}function g(e,t,n){if(!t||!C(e,t))return null;var i=n?"/"+(0,J.getSiteSlug)(e,n):"";return V.default.isEnabled("manage/themes/details")?"/theme/"+t+"/setup"+i:""+$.oldShowcaseUrl+i+t+"/support"}function _(e,t,n){if(!t)return null;var i=$.oldShowcaseUrl+t;return V.default.isEnabled("manage/themes/details")&&(i="/theme/"+t+"/support"),i+(n?"/"+(0,J.getSiteSlug)(e,n):"")}function T(e,t,n){return(0,J.isJetpackSite)(e,n)||!C(e,t)?null:"/checkout/"+(0,J.getSiteSlug)(e,n)+"/theme:"+t}function v(e,t,n){var i=(0,J.getCustomizerUrl)(e,n);if(!n||!t||S(e,t,n))return i;var r=(0,O.includes)(i,"?")?"&":"?",s=void 0;if((0,J.isJetpackSite)(e,n))s=t;else{var o=K(e,"wpcom",t);if(!o)return i;s=o.stylesheet}return i+r+"theme="+s}function E(e,t){if(!t)return null;var n="/start/with-theme?ref=calypshowcase&theme="+t;return C(e,t)&&(n+="&premium=true"),n}function y(e,t,n){var i=r(e,n,t);return(0,O.get)(i,"demo_uri")}function j(e,t){return C(e,t)?"//premium-themes.forums.wordpress.com/forum/"+t:f(e,t)?"//en.forums.wordpress.com/forum/themes":p(e,t)?"//wordpress.org/support/theme/"+t:null}function b(e,t){var n=(0,O.get)(e.themes.activeThemes,t,null);return n&&n.replace("-wpcom","")}function S(e,t,n){return b(e,n)===t}function I(e,t){return(0,O.get)(e.themes.activationRequests,t,!1)}function w(e,t){return(0,O.get)(e.themes.completedActivationRequests,t,!1)}function A(e,t,n){var i=X(e,t,n);return(0,O.get)(e.themes.themeInstalls,[n,i],!1)}function C(e,t){var n=K(e,"wpcom",t);return(0,$.isPremium)(n)}function x(e,t,n){return P(e,t,n)||(0,G.hasFeature)(e,n,Z.FEATURE_UNLIMITED_PREMIUM_THEMES)}function R(e,t,n){return!!K(e,n,t)||f(e,t)&&V.default.isEnabled("manage/themes/upload")&&(0,J.hasJetpackSiteJetpackThemesExtendedFeatures)(e,n)}function P(e,t,n){var i=(0,B.getSitePurchases)(e,n);return(0,O.some)(i,{productSlug:"premium_theme",meta:t})}function U(e){return(0,O.get)(e.themes,"themePreviewOptions",{})}function M(e){return(0,O.get)(e.themes,"themePreviewVisibility",null)}function k(e,t){return(0,O.get)(K(e,"wpcom",t),"template",null)}function z(e,t){var n=(0,O.get)(K(e,"wpcom",t),"download","");return!!(0,O.includes)(n,"wordpress.com")}function q(e,t){return(0,J.isJetpackSite)(e,t)&&V.default.isEnabled("manage/themes/upload")&&(0,J.hasJetpackSiteJetpackThemesExtendedFeatures)(e,t)&&!(0,J.isJetpackSiteMultiSite)(e,t)}function L(e,t,n){return(0,J.isJetpackSite)(e,n)&&C(e,t)&&!(0,G.hasFeature)(e,n,Z.FEATURE_UNLIMITED_PREMIUM_THEMES)?"/checkout/"+(0,J.getSiteSlug)(e,n)+"/professional":null}function F(e,t,n){if(!C(e,t)||x(e,t,n))return"";if((0,J.isJetpackSite)(e,n))return D.default.translate("Upgrade",{comment:"Used to indicate a premium theme is available to the user once they upgrade their plan"});var i=K(e,"wpcom",t);return(0,O.get)(i,"price")}Object.defineProperty(t,"__esModule",{value:!0}),t.isRequestingThemesForQueryIgnoringPage=t.getThemesForQueryIgnoringPage=t.getThemesForQuery=t.getTheme=void 0,t.getCanonicalTheme=r,t.getThemeRequestErrors=s,t.getLastThemeQuery=o,t.isRequestingThemesForQuery=a,t.getThemesFoundForQuery=u,t.getThemesLastPageForQuery=l,t.isThemesLastPageForQuery=c,t.isRequestingTheme=d,t.isRequestingActiveTheme=m,t.isWpcomTheme=f,t.isWporgTheme=p,t.getThemeDetailsUrl=h,t.getThemeSupportUrl=g,t.getThemeHelpUrl=_,t.getThemePurchaseUrl=T,t.getThemeCustomizeUrl=v,t.getThemeSignupUrl=E,t.getThemeDemoUrl=y,t.getThemeForumUrl=j,t.getActiveTheme=b,t.isThemeActive=S,t.isActivatingTheme=I,t.hasActivatedTheme=w,t.isInstallingTheme=A,t.isThemePremium=C,t.isPremiumThemeAvailable=x,t.isThemeAvailableOnJetpackSite=R,t.isThemePurchased=P,t.getThemePreviewThemeOptions=U,t.themePreviewVisibility=M,t.getWpcomParentThemeId=k,t.isDownloadableFromWpcom=z,t.shouldFilterWpcomThemes=q,t.getJetpackUpgradeUrlIfPremiumTheme=L,t.getPremiumThemePrice=F;var O=n("./node_modules/lodash/lodash.js"),N=n("./node_modules/i18n-calypso/index.js"),D=i(N),H=n("./client/lib/create-selector/index.js"),Q=i(H),W=n("./client/config/index.js"),V=i(W),J=n("./client/state/sites/selectors.js"),B=n("./client/state/purchases/selectors.js"),G=n("./client/state/sites/plans/selectors.js"),$=n("./client/state/themes/utils.js"),Y=n("./client/state/themes/constants.js"),Z=n("./client/lib/plans/constants.js"),K=t.getTheme=(0,Q.default)(function(e,t,n){var i=e.themes.queries[t];return i?i.getItem(n):null},function(e){return e.themes.queries}),X=function(e,t,n){var i=n&&(0,J.isJetpackSite)(e,n);return i&&!K(e,n,t)?t+"-wpcom":t};t.getThemesForQuery=(0,Q.default)(function(e,t,n){var i=e.themes.queries[t];if(!i)return null;var r=i.getItems(n);return r?(0,O.includes)(r,void 0)?null:(0,O.uniq)(r):null},function(e){return e.themes.queries},function(e,t,n){return(0,$.getSerializedThemesQuery)(n,t)}),t.getThemesForQueryIgnoringPage=(0,Q.default)(function(e,t,n){var i=e.themes.queries[t];if(!i)return null;var r=i.getItemsIgnoringPage(n);return r?(0,O.uniq)(r):null},function(e){return e.themes.queries},function(e,t,n){return(0,$.getSerializedThemesQueryWithoutPage)(n,t)}),t.isRequestingThemesForQueryIgnoringPage=(0,Q.default)(function(e,t,n){var i=(0,O.omit)((0,$.getNormalizedThemesQuery)(n),"page");return(0,O.some)(e.themes.queryRequests,function(e,n){if(!e)return!1;var r=(0,$.getDeserializedThemesQueryDetails)(n);return r.siteId===t&&(0,O.isEqual)(i,(0,O.omit)(r.query,"page"))})},function(e){return e.themes.queryRequests},function(e,t,n){return(0,$.getSerializedThemesQuery)(n,t)})},"./node_modules/escape-regexp-component/index.js":function(e,t){e.exports=function(e){return String(e).replace(/([.*+?=^!:${}()|[\]\/\\])/g,"\\$1")}},"./node_modules/escape-regexp/index.js":function(e,t){e.exports=function(e){return String(e).replace(/([.*+?=^!:${}()|[\]\/\\])/g,"\\$1")}},"./node_modules/title-case-minors/index.js":function(e,t){e.exports=["a","an","and","as","at","but","by","en","for","from","how","if","in","neither","nor","of","on","only","onto","out","or","per","so","than","that","the","to","until","up","upon","v","v.","versus","vs","vs.","via","when","with","without","yet"]},"./node_modules/to-capital-case/index.js":function(e,t,n){function i(e){return r(e).replace(/(^|\s)(\w)/g,function(e,t,n){return t+n.toUpperCase()})}var r=n("./node_modules/to-capital-case/node_modules/to-no-case/index.js");e.exports=i},"./node_modules/to-capital-case/node_modules/to-no-case/index.js":function(e,t){function n(e){return s.test(e)?e.toLowerCase():(a.test(e)&&(e=i(e)),o.test(e)&&(e=r(e)),e.toLowerCase())}function i(e){return e.replace(u,function(e,t){return t?" "+t:""})}function r(e){return e.replace(l,function(e,t,n){return t+" "+n.toLowerCase().split("").join(" ")})}e.exports=n;var s=/\s/,o=/[a-z][A-Z]/,a=/[\W_]/,u=/[\W_]+(.|$)/g,l=/(.)([A-Z]+)/g},"./node_modules/to-title-case/index.js":function(e,t,n){function i(e){return s(e).replace(u,function(e){return e.toLowerCase()}).replace(l,function(e){return e.toUpperCase()})}try{var r=n("./node_modules/escape-regexp/index.js")}catch(e){var r=n("./node_modules/escape-regexp-component/index.js")}var s=n("./node_modules/to-capital-case/index.js"),o=n("./node_modules/title-case-minors/index.js");e.exports=i;var a=o.map(r),u=new RegExp("[^^]\\b("+a.join("|")+")\\b","ig"),l=/:\s*(\w)/g}});